<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Jugador - Campus Party Game</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family:'Segoe UI', Tahoma, sans-serif;
      background:#121212;
      color:#fff;
      height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .mobile-container {
      width: 90%;
      max-width: 600px;
      background: #1e1e1e;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.5);
      text-align: center;
    }
    #player-form input {
      width: 100%;
      padding: 12px;
      margin-bottom: 15px;
      font-size: 1rem;
      border: 1px solid #333;
      border-radius: 6px;
      background: #2a2a2a;
      color: #fff;
    }
    #player-form button {
      width: 100%;
      padding: 14px;
      font-size: 1.1rem;
      border: none;
      border-radius: 6px;
      background: #CFFE47;
      color: #000;
      cursor: pointer;
      margin-top: 10px;
      transition: background 0.3s;
    }
    #player-form button:hover {
      background: #b5e23d;
    }
    #waiting-screen {
      display: none;
      font-size: 1.2rem;
      margin-top: 20px;
      color: #ddd;
    }
    #question-text-mobile {
      display: none;
      font-size: 1.4rem;
      font-weight: 600;
      margin-bottom: 20px;
      background: #2a2a2a;
      padding: 15px;
      border-radius: 8px;
      color: #fff;
    }
    #answer-buttons button {
      display: block;
      width: 100%;
      padding: 15px;
      margin: 10px 0;
      font-size: 1.1rem;
      border: none;
      border-radius: 8px;
      background-color: #2a2a2a;
      color: #fff;
      transition: background 0.3s, border-color 0.3s;
      border: 2px solid transparent;
    }
    #answer-buttons button:hover {
      background-color: #333;
      border-color: #CFFE47;
    }
  </style>
  <script src="/socket.io/socket.io.js"></script>
</head>
<body>
  <div class="mobile-container">
    <div id="player-form">
      <input id="player-name" type="text" placeholder="Tu nombre" />
      <input id="player-email" type="email" placeholder="Tu correo" />
      <input id="player-sala" type="text" placeholder="ID de sala" />
      <button id="btnStart">Unirme al juego</button>
    </div>

    <div id="waiting-screen">
      <p>Esperando que comience el juego...</p>
    </div>

    <div id="question-text-mobile"></div>
    <div id="answer-buttons"></div>
  </div>

  <script>
    const socket = io();
    let salaId = null;
    let preguntaId = null;

    const form = document.getElementById("player-form");
    const waiting = document.getElementById("waiting-screen");
    const nameInput = document.getElementById("player-name");
    const emailInput = document.getElementById("player-email");
    const salaInput = document.getElementById("player-sala");
    const questionText = document.getElementById("question-text-mobile");
    const answerButtons = document.getElementById("answer-buttons");

    const params = new URLSearchParams(window.location.search);
    const salaParam = params.get("salaId");
    if (salaParam) salaInput.value = salaParam;

    document.getElementById("btnStart").onclick = () => {
      const nombre = nameInput.value.trim();
      const correo = emailInput.value.trim();
      salaId = salaInput.value.trim();

      if (!nombre || !correo || !salaId) {
        alert("Por favor completÃ¡ todos los campos.");
        return;
      }

      socket.emit("joinSala", {
        salaId,
        tipo: "jugador",
        nombre,
        correo
      });

      form.style.display = "none";
      waiting.style.display = "block";
    };

    socket.on("preguntaNueva", (data) => {
      console.log("ðŸŸ¨ Recibida preguntaNueva:", data);
      preguntaId = data.preguntaId;
      waiting.style.display = "none";
      questionText.style.display = "block";
      questionText.innerText = data.preguntaText || data.question || data.texto || "Pregunta sin texto";

      answerButtons.innerHTML = "";
      answerButtons.style.display = "block";

      const opciones = data.options || [
        data.answer1,
        data.answer2,
        data.answer3,
        data.answer4
      ].filter(Boolean);

      opciones.forEach((opcion, index) => {
        const btn = document.createElement("button");
        btn.innerText = opcion;
        btn.id = "btn" + index;
        btn.onclick = () => {
          socket.emit("votar", {
            salaId,
            preguntaId,
            opcionElegida: opcion
          });
          questionText.innerText = "âœ… Â¡Respuesta enviada!";
          answerButtons.innerHTML = "";
        };
        answerButtons.appendChild(btn);
      });
    });

    socket.on("votosActualizados", (votos) => {
      console.log("ðŸ“Š Votos:", votos);
    });
  </script>
</body>
</html>
